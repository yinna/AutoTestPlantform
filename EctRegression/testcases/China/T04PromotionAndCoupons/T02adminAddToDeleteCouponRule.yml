
config:
    name: "request methods testcase with functions"
    base_url: "http://mall.ectpp.opsmart.cn"
    variables: 
        shanghaiCityEntity: ${getCityEntityInfo(shanghai)}
        ningboCityEntity: ${getCityEntityInfo(ningbo)}
        shekouCityEntity: ${getCityEntityInfo(shekou)}
        shekouPortEntity: ${getPortEntityInfo(shekou)}
        hoChiMinhPortEntity: ${getPortEntityInfo(shekou)}
        NewYorkPortEntity: ${getPortEntityInfo(New York)}
        shanghaiPortEntity: ${getPortEntityInfo(shanghai)}
        ningboPortEntity: ${getPortEntityInfo(ningbo)}
        penangPortEntity: ${getPortEntityInfo(Penang)}
        karachiCityEntity: ${getCityEntityInfo(Karachi)}
        rotterdamCityEntity: ${getCityEntityInfo(Rotterdam)}
        shanghaiCityUuid: ${getCityUuid(Shanghai)}
        ningboCityUuid: ${getCityUuid(Ningbo)}
        shekouCityUuid: ${getCityUuid(Shekou)}
        karachiCityUuid: ${getCityUuid(Karachi)}
        hoChiMinhCityUuid: ${getCityUuid(Ho Chi Minh)}
        rotterdamCityUuid: ${getCityUuid(Rotterdam)}
        karachiPortUuid: ${getPortUuid(Karachi)}
        hoChiMinhPortUuid: ${getPortUuid(Ho Chi Minh)}
        newYorkPortUuid: ${getPortUuid(New York)}
        shanghaiPortUuid: ${getPortUuid(Shanghai)}
        ningboPortUuid: ${getPortUuid(Ningbo)}
        penangPortUuid: ${getPortUuid(Penang)}
        today: ${getCurrentDay()}
        couponName: ${getJoinString($today,join,新增优惠券automation)}
    verify: False

teststeps:
-
    name: login
    # api: testcases/China/T01setUp/T02cnAdminLogin.yml  #api/testcase效果一致
    testcase: testcases/China/T01setUp/T02cnAdminLogin.yml
    export:
        - cnAdminUserToken

-
    name: admin add coupon rule 
    request:
        method: POST
        url: /api/product/coupon/GENERAL/create-rule
        json: {"assignmentRuleParams": [{"assignType": "REGISTER","assignUnit": "DEFAULT","assignAmount": 1,"filterEndTime": "2021-01-31T15:59:59.000Z","filterStartTime": "2020-08-31T16:00:00.000Z","assignQuantity": 1,"filterTimeOption": "REGISTER_TIME"}],"usageRuleParam": {"name": $couponName,"type": "SHIPMENT","validityType": "PERIOD","value": 10,"currency": "USD","startTime": "","endTime": "","usageUnit": "TEU","status": "DISABLE","tradeArea": "APTD","tradeLane": ["AUS","AUZ","IAR","IAG"],"serviceCode": ["PMX","AEU5"],"vesselName": "COSCO ANTWERP","voyageNo": "200","direction": "W","commodityCode": "automation","porCityUuid": [$shanghaiCityUuid,$ningboCityUuid],"exPorCityUuid": [$shekouCityUuid],"porCitys": [$shanghaiCityEntity,$ningboCityEntity],"exPorCitys": [$shekouCityEntity],"podPortUuid": [$karachiPortUuid,$hoChiMinhPortUuid],"exPodPortUuid": [$newYorkPortUuid],"podPorts": [$shekouPortEntity,$hoChiMinhPortEntity],"exPodPorts": [$NewYorkPortEntity],"polPortUuid": [$shanghaiPortUuid,$ningboPortUuid],"exPolPortUuid": [$penangPortUuid],"polPorts": [$shanghaiPortEntity,$ningboPortEntity],"exPolPorts": [$penangPortEntity],"fndCityUuid": [$karachiCityUuid,$hoChiMinhCityUuid],"exFndCityUuid": [$rotterdamCityUuid],"fndCitys": [$karachiCityEntity],"exFndCitys": [$rotterdamCityEntity],"minOceanFee": 200,"maxOceanFee": 500,"maxUseLimit": 3,"isScheduled": 0,"periodUnit": "WEEKS","periodValue": 2,"cargoType": "GENERAL","porCtryCode": "CN","fndCtryCode": "PK","exPorCtryCode": ["PK"],"exFndCtryCode": ["HK"],"allowWithdraw": true}}
        headers:
            X-Auth-Token: $cnAdminUserToken
            Content-Type: application/json;charset=UTF-8
    teardown_hooks:
        - ${sleepTime(2)}
    validate:
        - eq: ['status_code', 200]

-
    name: admin query coupon info and get coupon id
    request:
        method: POST
        url: /api/product/coupon/GENERAL/search-rule?sortBy=updateTime&page=1&size=20
        json: {"status":"","porCityUuid":"","isScheduled":"","assignmentType":"","polPortUuid":"","podPortUuid":"","fndCityUuid":"","porCtryCode":"","fndCtryCode":"","exPorCtryCode":"","exPorCityUuid":"","exFndCityUuid":"","exFndCtryCode":"","exPolPortUuid":"","exPodPortUuid":"","usageUnit":"ALL","channelCode":"GENERAL","isActive":1,"name":$couponName}
        headers:
            X-Auth-Token: $cnAdminUserToken
            Content-Type: application/json;charset=UTF-8
    extract:
        couponRuleId: "body.content.0.id"
    validate:
        - eq: ['status_code', 200]

-
    name: set coupon rule status from disable to enable
    request:
        method: POST
        url: /api/product/coupon/GENERAL/change-rule-status
        headers:
            X-Auth-Token: $cnAdminUserToken
            Content-Type: application/json;charset=UTF-8
        json: {"id":$couponRuleId,"status":"ENABLE"}
    teardown_hooks:
        - ${sleepTime(1)}
    validate:
        - eq: ['status_code', 200]

-
    name: set coupon rule status from enable to disable
    request:
        method: POST
        url: /api/product/coupon/GENERAL/change-rule-status
        headers:
            X-Auth-Token: $cnAdminUserToken
            Content-Type: application/json;charset=UTF-8
        json: {"id":$couponRuleId,"status":"DISABLE"}
    teardown_hooks:
        - ${sleepTime(1)}
    validate:
        - eq: ['status_code', 200]

-
    name: delete coupon
    request:
        method: POST
        url: /api/product/coupon/GENERAL/delete-rule
        headers:
            X-Auth-Token: $cnAdminUserToken
            Content-Type: application/json;charset=UTF-8
        json: {"id":$couponRuleId}
    teardown_hooks:
        - ${sleepTime(1)}
    validate:
        - eq: ['status_code', 200]

#to do查询是否上架成功