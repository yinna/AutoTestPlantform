
config:
    name: "request methods testcase with functions"
    base_url: "http://admin.ectpp.opsmart.cn"
    verify: False
    variables:
        username: ${getEnvInfo(${ENV(TESTENV)},adminAccount)}
        password: ${getEnvInfo(${ENV(TESTENV)},adminPassword)}
    export: 
        - cnAdminUserToken

teststeps:
-
    name: get admin login captcha
    request:
        method: GET
        url: /api/common/captcha/image
        params:
            d: ${getTimestamp()}
        headers:
            Content-Type: Hm_lvt_ab44aa1c4d9b7bdf57dc3212a2d9b101=1607992854; sidebarStatus=1; Hm_lpvt_ab44aa1c4d9b7bdf57dc3212a2d9b101=1608032943
    extract:
        returnAdminCookie: "cookies.ECTIMGCAPTCHA"
    validate:
        - eq: ["status_code", 200]

-
    name: admin login
    request:
        method: POST
        url: /api/admin/internal/user/login
        params: 
            username: $username
            password: $password
        headers:
            ECTIMGCAPTCHA: $returnAdminCookie
            Content-Type: application/json;charset=UTF-8
    extract:
        - cnAdminUserToken: "headers.X-Auth-Token"
    validate:
        - eq: ['status_code', 200]

-
    name: admin set tenant
    request:
        method: PUT
        url: /api/admin/internal/user/update-internal-shared-user-by-tenant/a63727e57aaa2660e0539fe716acc5ab
        headers:
            X-Auth-Token: $cnAdminUserToken
            Content-Type: application/json;charset=UTF-8
    validate:
        - eq: ['status_code', 200]